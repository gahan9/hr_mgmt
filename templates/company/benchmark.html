{% extends 'common/common.html' %}
{% load static %}
{% load i18n %}
{% load rest_framework %}
{% block content %}
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
        <li class="breadcrumb-item"><a href="{% url 'field_rate' %}">{{ SITE_NAME }}</a></li>
        <li class="breadcrumb-item active">benchmark</li>
    </ol>
    <!-- Content -->
    <div class="main-sub-container">
        <div class="container" id="accordion">
        </div>
    </div>

{% endblock %}
{% block extrajs %}
    <script type="text/javascript">
        var csrftoken = Cookies.get('csrftoken');
        var user_token = '{{ user.auth_token.key }}';
        var api_url = '/api/v1/survey/?benchmark=true';
        var results = null;

        function setCSRF(xhr, settings) {
            xhr.setRequestHeader("Authorization", "Token " + user_token);
            xhr.setRequestHeader("X-CSRFToken", csrftoken);
        }

        $(document).ready(function () {
            GetRequest(api_url);
        });

        function QuestionFetch(content, item_id) {
            var que = '<div class="col">';
            $.each(content, function(i, item) {
                if (i !== "count"){
                que += '<div class="col">' +
                    '<div class="row h5"> &nbsp;&nbsp;<strong>'+ item.question_title +
                        '&nbsp;&nbsp;&nbsp; <i class="fa fa-caret-square-o-right"></i></strong></div>'+
                        '<div class=row> <strong>Average Rating: &nbsp;&nbsp;</strong>'+ item.average_rating +' out of '+ item.rate_scale +'</div>'+
                        '<div class=row> <strong>Total Rating: &nbsp;&nbsp;</strong>'+ item.rating +'</div>'+
                        '<div class=row> <strong>Total Responses: &nbsp;&nbsp;</strong>'+ item.total_responses +'</div>'+
                        '<div class=row> <strong>Cities: &nbsp;&nbsp;</strong>'+ item.cities +'</div>'+
                        '&nbsp;&nbsp; </div>';
                }
            });
            que += '</div>';
            return que
        }

        function AddData(content) {
            $.each(content, function (i, item) {
                var item_id = item.id;
                var $block = $('<div class="card">').append(
                    $('<div class="card-header">').append(
                        $('<h5 class="mb-0">').html(`
                            <button class="btn btn-link collapsed" data-toggle="collapse"
                                data-target="#`+ item_id +`" aria-expanded="false"
                                aria-controls="`+ item_id +`">` +
                            '<span>' + item.name + '</span></button>'
                        )
                    ),
                    $('<div id="'+ item_id +'" class="collapse" aria-labelledby="headingOne" ' +
                        'data-parent="#accordion">').append('<div class="card-body">').html(
                            QuestionFetch(item.benchmark, item_id)
                    )
                ).appendTo("#accordion")
            })
            }

        function GetRequest(url) {
            $.ajax({
                url: url,
                method: "GET",
                contentType: "application/json;charset=utf-8",
                beforeSend: setCSRF,
                success: function (responseObj) {
                    console.log("Saved! It worked.");
                    results = responseObj.results;
                    AddData(results);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("some error " + String(errorThrown) + String(textStatus) + String(XMLHttpRequest.responseText));
                }
            });
        }
        function CustomRequest(content) {
            $.ajax({
                url: content.url,
                method: content.method,
                data: JSON.stringify(content.data),
                contentType: "application/json;charset=utf-8",
                beforeSend: setCSRF,
                success: function (responseObj) {
                    console.log("Saved! It worked.");
                    console.log(responseObj);
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("some error " + String(errorThrown) + String(textStatus) + String(XMLHttpRequest.responseText));
                }
            });
        }

    </script>
{% endblock %}